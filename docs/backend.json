{
  "entities": {
    "UserAccount": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserAccount",
      "type": "object",
      "description": "Represents a user account in the EcoCart Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user account."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        },
        "shippingAddresses": {
          "type": "array",
          "description": "References to the user's shipping addresses. (Relationship: UserAccount 1:N Address)",
          "items": {
            "type": "string"
          }
        },
        "billingAddresses": {
          "type": "array",
          "description": "References to the user's billing addresses. (Relationship: UserAccount 1:N Address)",
          "items": {
            "type": "string"
          }
        },
        "roles": {
          "type": "array",
          "description": "Roles assigned to the user.",
          "items": {
            "type": "string",
            "enum": [
              "admin",
              "customer"
            ]
          }
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available on the EcoCart Marketplace.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "materials": {
          "type": "string",
          "description": "Information about the materials used in the product."
        },
        "certifications": {
          "type": "string",
          "description": "Certifications held by the product."
        },
        "sustainabilityImpact": {
          "type": "string",
          "description": "Description of the product's sustainability impact."
        },
        "categoryIds": {
          "type": "array",
          "description": "References to Categories. (Relationship: Category N:N Product)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to UserAccount. (Relationship: UserAccount 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "shippingAddressId": {
          "type": "string",
          "description": "Reference to Address. (Relationship: Order 1:1 Address)"
        },
        "orderItemIds": {
          "type": "array",
          "description": "References to OrderItems. (Relationship: Order 1:N OrderItem)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product at the time of the order."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Address": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Address",
      "type": "object",
      "description": "Represents a shipping or billing address.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the address."
        },
        "streetAddress": {
          "type": "string",
          "description": "Street address."
        },
        "city": {
          "type": "string",
          "description": "City."
        },
        "state": {
          "type": "string",
          "description": "State."
        },
        "zipCode": {
          "type": "string",
          "description": "Zip code."
        },
        "country": {
          "type": "string",
          "description": "Country."
        }
      },
      "required": [
        "id",
        "streetAddress",
        "city",
        "state",
        "zipCode",
        "country"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com",
      "facebook.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserAccount",
          "schema": {
            "$ref": "#/backend/entities/UserAccount"
          },
          "description": "Stores user account information. This path enforces ownership-based security, allowing only the authenticated user to access their own data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user account."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information. Products are publicly accessible.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores category information. Categories are publicly accessible.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier of the category."
            }
          ]
        }
      },
      {
        "path": "/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information for a specific user. This path enforces ownership-based security, allowing only the authenticated user to access their own orders.",
          "params": [
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure authorization independence, clarity, and scalability for the EcoCart Marketplace application. User data is segregated into `/users/{userId}` collections, enabling straightforward ownership-based security rules. Product and Category data are stored in root-level collections (`/products`, `/categories`) with no access restrictions, facilitating easy listing and filtering. Orders are in their own collection to be viewed by admins. This structure eliminates the need for `get()` calls in security rules, as all necessary authorization context is available within the document or through path-based ownership. This approach ensures atomic operations and simplifies debugging. Segregation of data based on access requirements (e.g., public products vs. private user data) supports secure list operations. This design enables straightforward implementation of security rules based solely on `request.auth.uid` and the document path, promoting maintainability and security."
  }
}
